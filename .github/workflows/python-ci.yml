# Nombre del workflow, aparecer치 en la interfaz de GitHub Actions
name: QA Automation Suite CI

# --- Eventos que Disparan el Workflow ---
on:
  # Dispara el workflow cuando se hace un push a las ramas especificadas
  push:
    branches:
      - main # La rama principal donde reside tu c칩digo estable
      - develop # Si usas una rama de desarrollo para nuevas funcionalidades
      # - infra/gitignore-y-ci-validado # Si ya la fusionaste a main, puedes removerla de aqu칤 para limpiar
    paths-ignore: # Ignora estos archivos/patrones para disparar el workflow en un 'push'
      - '**.md'   # Ignora todos los archivos Markdown (ej. README.md, CHANGELOG.md)
      - 'docs/**' # Ignora cualquier cambio en una posible carpeta 'docs/'
      - 'LICENSE' # Ignora cambios en el archivo de licencia

  # Dispara el workflow cuando se abre o actualiza un Pull Request hacia las ramas especificadas
  # Para Pull Requests, generalmente querr치s que el CI se ejecute en todos los cambios
  # para una validaci칩n completa antes de fusionar.
  pull_request:
    branches:
      - main
      - develop
      # - infra/gitignore-y-ci-validado # Si ya la fusionaste a main, puedes removerla de aqu칤 para limpiar

  # Permite ejecutar el workflow manualmente desde la interfaz de GitHub Actions
  workflow_dispatch:

# --- Definici칩n de los Jobs (Trabajos) ---
jobs:
  run_tests_job:
    name: Ejecutar Pruebas Automatizadas
    # Define el sistema operativo del 'runner' (servidor virtual) donde se ejecutar치 este job
    runs-on: ubuntu-latest

    # --- Pasos del Job ---
    steps:
      # Paso 1: Descarga el c칩digo de tu repositorio
      - name: 拘勇 Checkout del C칩digo
        uses: actions/checkout@v4

      # Paso 2: Configura el entorno de Python
      - name: 游냀 Configurar Entorno Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # Puedes especificar una versi칩n exacta como '3.10' o '3.11'

      # Paso 3: Instalar dependencias del sistema necesarias
      # (Ejemplo: curl es 칰til para algunos setups, si no se usa, puede removerse)
      - name: 丘뙖잺 Instalar Dependencias del Sistema (apt-get)
        run: |
          sudo apt-get update
          sudo apt-get install -y curl

      # Paso 4: Instalar las dependencias de Python (librer칤as)
      - name: 游닍 Instalar Dependencias de Python (pip)
        run: |
          python -m pip install --upgrade pip
          pip install --upgrade setuptools # Asegura que setuptools est칠 instalado y actualizado
          pip install -r requirements.txt

      # Paso 5: Recrear los archivos JSON sensibles desde los Secretos de GitHub
      - name: 游댏 Configurar Credenciales de Google desde Secretos (Solo en CI)
        env:
          CLIENT_SECRET_CONTENT: ${{ secrets.GOOGLE_CLIENT_SECRET_JSON }}
          CREDENTIALS_CONTENT: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
          TOKEN_CONTENT: ${{ secrets.GOOGLE_API_TOKEN_JSON }}

        run: |
          mkdir -p config
          echo "${CLIENT_SECRET_CONTENT}" > config/client_secret.json
          echo "${CREDENTIALS_CONTENT}" > config/credentials.json
          echo "${TOKEN_CONTENT}" > config/token.json
          echo "Archivos de credenciales sensibles creados temporalmente para la ejecuci칩n de CI."

      # Paso 6: Ejecutar el script principal de tu suite de automatizaci칩n
      # IMPORTANTE: El 'working-directory' ahora apunta a 'tests/'
      - name: 游 Ejecutar Suite de Automatizaci칩n QA
        working-directory: tests/ # 춰Este es el cambio crucial!
        run: |
          python suite.py
        env:
          BROWSER_HEADLESS: true # Establece a 'true' para CI (recomendado)

      # Paso 7: Subir los artefactos (resultados) del workflow
      # IMPORTANTE: Aseg칰rate de que la carpeta 'reports/' se cree en la ra칤z del repositorio
      # o ajusta esta ruta si se crea dentro de 'tests/'. Si `suite.py` crea 'reports/'
      # dentro de 'tests/', entonces la ruta aqu칤 deber칤a ser 'tests/reports/'.
      # Dado que tu estructura original tiene 'reports/' en la ra칤z, mantendremos eso.
      - name: 拘勇 Subir Reportes como Artefacto
        uses: actions/upload-artifact@v4
        with:
          name: test-reports
          path: reports/